   1              		.cpu cortex-m4
   2              		.eabi_attribute 20, 1
   3              		.eabi_attribute 21, 1
   4              		.eabi_attribute 23, 3
   5              		.eabi_attribute 24, 1
   6              		.eabi_attribute 25, 1
   7              		.eabi_attribute 26, 1
   8              		.eabi_attribute 30, 4
   9              		.eabi_attribute 34, 1
  10              		.eabi_attribute 18, 4
  11              		.file	"simpleserial.c"
  12              		.text
  13              	.Ltext0:
  14              		.cfi_sections	.debug_frame
  15              		.section	.text.check_version,"ax",%progbits
  16              		.align	1
  17              		.global	check_version
  18              		.arch armv7e-m
  19              		.syntax unified
  20              		.thumb
  21              		.thumb_func
  22              		.fpu softvfp
  24              	check_version:
  25              	.LVL0:
  26              	.LFB1:
  27              		.file 1 ".././simpleserial/simpleserial.c"
   1:.././simpleserial/simpleserial.c **** // simpleserial.c
   2:.././simpleserial/simpleserial.c **** 
   3:.././simpleserial/simpleserial.c **** #include "simpleserial.h"
   4:.././simpleserial/simpleserial.c **** #include <stdint.h>
   5:.././simpleserial/simpleserial.c **** #include "hal.h"
   6:.././simpleserial/simpleserial.c **** 
   7:.././simpleserial/simpleserial.c **** 
   8:.././simpleserial/simpleserial.c **** #define MAX_SS_CMDS 16
   9:.././simpleserial/simpleserial.c **** static int num_commands = 0;
  10:.././simpleserial/simpleserial.c **** 
  11:.././simpleserial/simpleserial.c **** #define MAX_SS_LEN 192
  12:.././simpleserial/simpleserial.c **** 
  13:.././simpleserial/simpleserial.c **** //#define SS_VER_1_0 0
  14:.././simpleserial/simpleserial.c **** //#define SS_VER_1_1 1
  15:.././simpleserial/simpleserial.c **** //#define SS_VER_2_0 2
  16:.././simpleserial/simpleserial.c **** 
  17:.././simpleserial/simpleserial.c **** 
  18:.././simpleserial/simpleserial.c **** // 0xA6 formerly 
  19:.././simpleserial/simpleserial.c **** #define CW_CRC 0x4D 
  20:.././simpleserial/simpleserial.c **** uint8_t ss_crc(uint8_t *buf, uint8_t len)
  21:.././simpleserial/simpleserial.c **** {
  22:.././simpleserial/simpleserial.c **** 	unsigned int k = 0;
  23:.././simpleserial/simpleserial.c **** 	uint8_t crc = 0x00;
  24:.././simpleserial/simpleserial.c **** 	while (len--) {
  25:.././simpleserial/simpleserial.c **** 		crc ^= *buf++;
  26:.././simpleserial/simpleserial.c **** 		for (k = 0; k < 8; k++) {
  27:.././simpleserial/simpleserial.c **** 			crc = crc & 0x80 ? (crc << 1) ^ CW_CRC: crc << 1;
  28:.././simpleserial/simpleserial.c **** 		}
  29:.././simpleserial/simpleserial.c **** 	}
  30:.././simpleserial/simpleserial.c **** 	return crc;
  31:.././simpleserial/simpleserial.c **** 
  32:.././simpleserial/simpleserial.c **** }
  33:.././simpleserial/simpleserial.c **** 
  34:.././simpleserial/simpleserial.c **** // [B_STUFF, CMD, SCMD, LEN, B_STUFF, DATA..., CRC, TERM]
  35:.././simpleserial/simpleserial.c **** 
  36:.././simpleserial/simpleserial.c **** //#define SS_VER SS_VER_2_0
  37:.././simpleserial/simpleserial.c **** #if SS_VER == SS_VER_2_0
  38:.././simpleserial/simpleserial.c **** #error "SS_VER_2_0 is deprecated! Use SS_VER_2_1 instead."
  39:.././simpleserial/simpleserial.c **** #elif SS_VER == SS_VER_2_1
  40:.././simpleserial/simpleserial.c **** 
  41:.././simpleserial/simpleserial.c **** 
  42:.././simpleserial/simpleserial.c **** typedef struct ss_cmd
  43:.././simpleserial/simpleserial.c **** {
  44:.././simpleserial/simpleserial.c **** 	char c;
  45:.././simpleserial/simpleserial.c **** 	unsigned int len;
  46:.././simpleserial/simpleserial.c **** 	uint8_t (*fp)(uint8_t, uint8_t, uint8_t, uint8_t *);
  47:.././simpleserial/simpleserial.c **** } ss_cmd;
  48:.././simpleserial/simpleserial.c **** static ss_cmd commands[MAX_SS_CMDS];
  49:.././simpleserial/simpleserial.c **** 
  50:.././simpleserial/simpleserial.c **** void ss_puts(char *x)
  51:.././simpleserial/simpleserial.c **** {
  52:.././simpleserial/simpleserial.c **** 	do {
  53:.././simpleserial/simpleserial.c **** 		putch(*x);
  54:.././simpleserial/simpleserial.c **** 	} while (*++x);
  55:.././simpleserial/simpleserial.c **** }
  56:.././simpleserial/simpleserial.c **** 
  57:.././simpleserial/simpleserial.c **** #define FRAME_BYTE 0x00
  58:.././simpleserial/simpleserial.c **** 
  59:.././simpleserial/simpleserial.c **** uint8_t check_version(uint8_t cmd, uint8_t scmd, uint8_t len, uint8_t *data)
  60:.././simpleserial/simpleserial.c **** {
  61:.././simpleserial/simpleserial.c **** 	uint8_t ver = SS_VER;
  62:.././simpleserial/simpleserial.c **** 	simpleserial_put('r', 1, &ver);
  63:.././simpleserial/simpleserial.c **** 	return SS_ERR_OK;
  64:.././simpleserial/simpleserial.c **** }
  65:.././simpleserial/simpleserial.c **** 
  66:.././simpleserial/simpleserial.c **** uint8_t ss_get_commands(uint8_t cmd, uint8_t scmd, uint8_t len, uint8_t *data)
  67:.././simpleserial/simpleserial.c **** {
  68:.././simpleserial/simpleserial.c ****     uint8_t cmd_chars[MAX_SS_CMDS];
  69:.././simpleserial/simpleserial.c ****     for (uint8_t i = 0; i < (num_commands & 0xFF); i++) {
  70:.././simpleserial/simpleserial.c ****         cmd_chars[i] = commands[i].c;
  71:.././simpleserial/simpleserial.c ****     }
  72:.././simpleserial/simpleserial.c **** 
  73:.././simpleserial/simpleserial.c ****     simpleserial_put('r', num_commands & 0xFF, (void *)cmd_chars);
  74:.././simpleserial/simpleserial.c ****     return 0x00;
  75:.././simpleserial/simpleserial.c **** 
  76:.././simpleserial/simpleserial.c **** }
  77:.././simpleserial/simpleserial.c **** 
  78:.././simpleserial/simpleserial.c **** uint8_t stuff_data(uint8_t *buf, uint8_t len)
  79:.././simpleserial/simpleserial.c **** {
  80:.././simpleserial/simpleserial.c **** 	uint8_t i = 1;
  81:.././simpleserial/simpleserial.c **** 	uint8_t last = 0;
  82:.././simpleserial/simpleserial.c **** 	for (; i < len; i++) {
  83:.././simpleserial/simpleserial.c **** 		if (buf[i] == FRAME_BYTE) {
  84:.././simpleserial/simpleserial.c **** 			buf[last] = i - last;
  85:.././simpleserial/simpleserial.c **** 			last = i;
  86:.././simpleserial/simpleserial.c **** 		}
  87:.././simpleserial/simpleserial.c **** 	}
  88:.././simpleserial/simpleserial.c **** 	return 0x00;
  89:.././simpleserial/simpleserial.c **** }
  90:.././simpleserial/simpleserial.c **** 
  91:.././simpleserial/simpleserial.c **** uint8_t unstuff_data(uint8_t *buf, uint8_t len)
  92:.././simpleserial/simpleserial.c **** {
  93:.././simpleserial/simpleserial.c **** 	uint8_t next = buf[0];
  94:.././simpleserial/simpleserial.c **** 	buf[0] = 0x00;
  95:.././simpleserial/simpleserial.c **** 	//len -= 1;
  96:.././simpleserial/simpleserial.c **** 	uint8_t tmp = next;
  97:.././simpleserial/simpleserial.c **** 	while ((next < len) && tmp != 0) {
  98:.././simpleserial/simpleserial.c **** 		tmp = buf[next];
  99:.././simpleserial/simpleserial.c **** 		buf[next] = FRAME_BYTE;
 100:.././simpleserial/simpleserial.c **** 		next += tmp;
 101:.././simpleserial/simpleserial.c **** 	}
 102:.././simpleserial/simpleserial.c **** 	return next;
 103:.././simpleserial/simpleserial.c **** }
 104:.././simpleserial/simpleserial.c **** 
 105:.././simpleserial/simpleserial.c **** // Set up the SimpleSerial module by preparing internal commands
 106:.././simpleserial/simpleserial.c **** // This just adds the "v" command for now...
 107:.././simpleserial/simpleserial.c **** void simpleserial_init()
 108:.././simpleserial/simpleserial.c **** {
 109:.././simpleserial/simpleserial.c **** 	simpleserial_addcmd('v', 0, check_version);
 110:.././simpleserial/simpleserial.c ****     simpleserial_addcmd('w', 0, ss_get_commands);
 111:.././simpleserial/simpleserial.c **** }
 112:.././simpleserial/simpleserial.c **** 
 113:.././simpleserial/simpleserial.c **** int simpleserial_addcmd(char c, unsigned int len, uint8_t (*fp)(uint8_t, uint8_t, uint8_t, uint8_t*
 114:.././simpleserial/simpleserial.c **** {
 115:.././simpleserial/simpleserial.c **** 	if(num_commands >= MAX_SS_CMDS) {
 116:.././simpleserial/simpleserial.c **** 		putch('a');
 117:.././simpleserial/simpleserial.c **** 		return 1;
 118:.././simpleserial/simpleserial.c **** 	}
 119:.././simpleserial/simpleserial.c **** 
 120:.././simpleserial/simpleserial.c **** 	if(len >= MAX_SS_LEN) {
 121:.././simpleserial/simpleserial.c **** 		putch('b');
 122:.././simpleserial/simpleserial.c **** 		return 1;
 123:.././simpleserial/simpleserial.c **** 	}
 124:.././simpleserial/simpleserial.c **** 
 125:.././simpleserial/simpleserial.c **** 	commands[num_commands].c   = c;
 126:.././simpleserial/simpleserial.c **** 	commands[num_commands].len = len;
 127:.././simpleserial/simpleserial.c **** 	commands[num_commands].fp  = fp;
 128:.././simpleserial/simpleserial.c **** 	num_commands++;
 129:.././simpleserial/simpleserial.c **** 
 130:.././simpleserial/simpleserial.c **** 	return 0;
 131:.././simpleserial/simpleserial.c **** }
 132:.././simpleserial/simpleserial.c **** 
 133:.././simpleserial/simpleserial.c **** void simpleserial_get(void)
 134:.././simpleserial/simpleserial.c **** {
 135:.././simpleserial/simpleserial.c **** 	uint8_t data_buf[MAX_SS_LEN];
 136:.././simpleserial/simpleserial.c **** 	uint8_t err = 0;
 137:.././simpleserial/simpleserial.c **** 
 138:.././simpleserial/simpleserial.c **** 	for (int i = 0; i < 4; i++) {
 139:.././simpleserial/simpleserial.c **** 		data_buf[i] = getch(); //PTR, cmd, scmd, len
 140:.././simpleserial/simpleserial.c **** 		if (data_buf[i] == FRAME_BYTE) {
 141:.././simpleserial/simpleserial.c **** 			err = SS_ERR_FRAME_BYTE;
 142:.././simpleserial/simpleserial.c **** 			goto ERROR;
 143:.././simpleserial/simpleserial.c **** 		}
 144:.././simpleserial/simpleserial.c **** 	}
 145:.././simpleserial/simpleserial.c **** 	uint8_t next_frame = unstuff_data(data_buf, 4);
 146:.././simpleserial/simpleserial.c **** 
 147:.././simpleserial/simpleserial.c **** 	// check for valid command
 148:.././simpleserial/simpleserial.c **** 	uint8_t c = 0;
 149:.././simpleserial/simpleserial.c **** 	for(c = 0; c < num_commands; c++)
 150:.././simpleserial/simpleserial.c **** 	{
 151:.././simpleserial/simpleserial.c **** 		if(commands[c].c == data_buf[1])
 152:.././simpleserial/simpleserial.c **** 			break;
 153:.././simpleserial/simpleserial.c **** 	}
 154:.././simpleserial/simpleserial.c **** 
 155:.././simpleserial/simpleserial.c **** 	if (c == num_commands) {
 156:.././simpleserial/simpleserial.c **** 		err = SS_ERR_CMD;
 157:.././simpleserial/simpleserial.c **** 		goto ERROR;
 158:.././simpleserial/simpleserial.c **** 	}
 159:.././simpleserial/simpleserial.c **** 
 160:.././simpleserial/simpleserial.c **** 	//check that next frame not beyond end of message
 161:.././simpleserial/simpleserial.c **** 	// account for cmd, scmd, len, data, crc, end of frame
 162:.././simpleserial/simpleserial.c **** 	if ((data_buf[3] + 5) < next_frame) {
 163:.././simpleserial/simpleserial.c **** 		err = SS_ERR_LEN;
 164:.././simpleserial/simpleserial.c **** 		goto ERROR;
 165:.././simpleserial/simpleserial.c **** 	}
 166:.././simpleserial/simpleserial.c **** 
 167:.././simpleserial/simpleserial.c **** 	// read in data
 168:.././simpleserial/simpleserial.c **** 	// eq to len + crc + frame end
 169:.././simpleserial/simpleserial.c **** 	int i = 4;
 170:.././simpleserial/simpleserial.c **** 	for (; i < data_buf[3] + 5; i++) {
 171:.././simpleserial/simpleserial.c **** 		data_buf[i] = getch();
 172:.././simpleserial/simpleserial.c **** 		if (data_buf[i] == FRAME_BYTE) {
 173:.././simpleserial/simpleserial.c **** 			err = SS_ERR_FRAME_BYTE;
 174:.././simpleserial/simpleserial.c **** 			goto ERROR;
 175:.././simpleserial/simpleserial.c **** 		}
 176:.././simpleserial/simpleserial.c **** 	}
 177:.././simpleserial/simpleserial.c **** 
 178:.././simpleserial/simpleserial.c **** 	//check that final byte is the FRAME_BYTE
 179:.././simpleserial/simpleserial.c **** 	data_buf[i] = getch();
 180:.././simpleserial/simpleserial.c **** 	if (data_buf[i] != FRAME_BYTE) {
 181:.././simpleserial/simpleserial.c **** 		err = SS_ERR_LEN;
 182:.././simpleserial/simpleserial.c **** 		goto ERROR;
 183:.././simpleserial/simpleserial.c **** 	}
 184:.././simpleserial/simpleserial.c **** 
 185:.././simpleserial/simpleserial.c **** 	//fully unstuff data now
 186:.././simpleserial/simpleserial.c **** 	unstuff_data(data_buf + next_frame, i - next_frame + 1);
 187:.././simpleserial/simpleserial.c **** 
 188:.././simpleserial/simpleserial.c **** 	//calc crc excluding original frame offset and frame end and crc
 189:.././simpleserial/simpleserial.c **** 	uint8_t crc = ss_crc(data_buf+1, i-2);
 190:.././simpleserial/simpleserial.c **** 	if (crc != data_buf[i-1]) {
 191:.././simpleserial/simpleserial.c **** 		err = SS_ERR_CRC;
 192:.././simpleserial/simpleserial.c **** 		goto ERROR;
 193:.././simpleserial/simpleserial.c **** 	}
 194:.././simpleserial/simpleserial.c **** 
 195:.././simpleserial/simpleserial.c **** 	err = commands[c].fp(data_buf[1], data_buf[2], data_buf[3], data_buf+4);
 196:.././simpleserial/simpleserial.c **** 
 197:.././simpleserial/simpleserial.c **** ERROR:
 198:.././simpleserial/simpleserial.c **** 	simpleserial_put('e', 0x01, &err);
 199:.././simpleserial/simpleserial.c **** 	return;
 200:.././simpleserial/simpleserial.c **** }
 201:.././simpleserial/simpleserial.c **** 
 202:.././simpleserial/simpleserial.c **** void simpleserial_put(char c, uint8_t size, uint8_t* output)
 203:.././simpleserial/simpleserial.c **** {
 204:.././simpleserial/simpleserial.c **** 	uint8_t data_buf[MAX_SS_LEN];
 205:.././simpleserial/simpleserial.c **** 	data_buf[0] = 0x00;
 206:.././simpleserial/simpleserial.c **** 	data_buf[1] = c;
 207:.././simpleserial/simpleserial.c **** 	data_buf[2] = size;
 208:.././simpleserial/simpleserial.c **** 	int i = 0;
 209:.././simpleserial/simpleserial.c **** 	for (; i < size; i++) {
 210:.././simpleserial/simpleserial.c **** 		data_buf[i + 3] = output[i];
 211:.././simpleserial/simpleserial.c **** 	}
 212:.././simpleserial/simpleserial.c **** 	data_buf[i + 3] = ss_crc(data_buf+1, size+2);
 213:.././simpleserial/simpleserial.c **** 	data_buf[i + 4] = 0x00;
 214:.././simpleserial/simpleserial.c **** 	stuff_data(data_buf, i + 5);
 215:.././simpleserial/simpleserial.c **** 	for (int i = 0; i < size + 5; i++) {
 216:.././simpleserial/simpleserial.c **** 		putch(data_buf[i]);
 217:.././simpleserial/simpleserial.c **** 	}
 218:.././simpleserial/simpleserial.c **** }
 219:.././simpleserial/simpleserial.c **** 
 220:.././simpleserial/simpleserial.c **** 
 221:.././simpleserial/simpleserial.c **** #else
 222:.././simpleserial/simpleserial.c **** 
 223:.././simpleserial/simpleserial.c **** typedef struct ss_cmd
 224:.././simpleserial/simpleserial.c **** {
 225:.././simpleserial/simpleserial.c **** 	char c;
 226:.././simpleserial/simpleserial.c **** 	unsigned int len;
 227:.././simpleserial/simpleserial.c **** 	uint8_t (*fp)(uint8_t*, uint8_t);
 228:.././simpleserial/simpleserial.c **** 	uint8_t flags;
 229:.././simpleserial/simpleserial.c **** } ss_cmd;
 230:.././simpleserial/simpleserial.c **** static ss_cmd commands[MAX_SS_CMDS];
 231:.././simpleserial/simpleserial.c **** // Callback function for "v" command.
 232:.././simpleserial/simpleserial.c **** // This can exist in v1.0 as long as we don't actually send back an ack ("z")
 233:.././simpleserial/simpleserial.c **** uint8_t check_version(uint8_t *v, uint8_t len)
 234:.././simpleserial/simpleserial.c **** {
  28              		.loc 1 234 1 view -0
  29              		.cfi_startproc
  30              		@ args = 0, pretend = 0, frame = 0
  31              		@ frame_needed = 0, uses_anonymous_args = 0
  32              		@ link register save eliminated.
 235:.././simpleserial/simpleserial.c **** 	return SS_VER;
  33              		.loc 1 235 2 view .LVU1
 236:.././simpleserial/simpleserial.c **** }
  34              		.loc 1 236 1 is_stmt 0 view .LVU2
  35 0000 0020     		movs	r0, #0
  36              	.LVL1:
  37              		.loc 1 236 1 view .LVU3
  38 0002 7047     		bx	lr
  39              		.cfi_endproc
  40              	.LFE1:
  42              		.section	.text.ss_crc,"ax",%progbits
  43              		.align	1
  44              		.global	ss_crc
  45              		.syntax unified
  46              		.thumb
  47              		.thumb_func
  48              		.fpu softvfp
  50              	ss_crc:
  51              	.LVL2:
  52              	.LFB0:
  21:.././simpleserial/simpleserial.c **** 	unsigned int k = 0;
  53              		.loc 1 21 1 is_stmt 1 view -0
  54              		.cfi_startproc
  55              		@ args = 0, pretend = 0, frame = 0
  56              		@ frame_needed = 0, uses_anonymous_args = 0
  57              		@ link register save eliminated.
  21:.././simpleserial/simpleserial.c **** 	unsigned int k = 0;
  58              		.loc 1 21 1 is_stmt 0 view .LVU5
  59 0000 0346     		mov	r3, r0
  22:.././simpleserial/simpleserial.c **** 	uint8_t crc = 0x00;
  60              		.loc 1 22 2 is_stmt 1 view .LVU6
  61              	.LVL3:
  23:.././simpleserial/simpleserial.c **** 	while (len--) {
  62              		.loc 1 23 2 view .LVU7
  24:.././simpleserial/simpleserial.c **** 		crc ^= *buf++;
  63              		.loc 1 24 2 view .LVU8
  64 0002 0144     		add	r1, r1, r0
  65              	.LVL4:
  23:.././simpleserial/simpleserial.c **** 	while (len--) {
  66              		.loc 1 23 10 is_stmt 0 view .LVU9
  67 0004 0020     		movs	r0, #0
  68              	.LVL5:
  69              	.L3:
  24:.././simpleserial/simpleserial.c **** 		crc ^= *buf++;
  70              		.loc 1 24 8 is_stmt 1 view .LVU10
  24:.././simpleserial/simpleserial.c **** 		crc ^= *buf++;
  71              		.loc 1 24 8 is_stmt 0 view .LVU11
  72 0006 8B42     		cmp	r3, r1
  73 0008 00D1     		bne	.L7
  32:.././simpleserial/simpleserial.c **** 
  74              		.loc 1 32 1 view .LVU12
  75 000a 7047     		bx	lr
  76              	.L7:
  25:.././simpleserial/simpleserial.c **** 		for (k = 0; k < 8; k++) {
  77              		.loc 1 25 3 is_stmt 1 view .LVU13
  78              	.LVL6:
  25:.././simpleserial/simpleserial.c **** 		for (k = 0; k < 8; k++) {
  79              		.loc 1 25 7 is_stmt 0 view .LVU14
  80 000c 13F8012B 		ldrb	r2, [r3], #1	@ zero_extendqisi2
  81              	.LVL7:
  25:.././simpleserial/simpleserial.c **** 		for (k = 0; k < 8; k++) {
  82              		.loc 1 25 7 view .LVU15
  83 0010 5040     		eors	r0, r0, r2
  84              	.LVL8:
  26:.././simpleserial/simpleserial.c **** 			crc = crc & 0x80 ? (crc << 1) ^ CW_CRC: crc << 1;
  85              		.loc 1 26 3 is_stmt 1 view .LVU16
  26:.././simpleserial/simpleserial.c **** 			crc = crc & 0x80 ? (crc << 1) ^ CW_CRC: crc << 1;
  86              		.loc 1 26 15 view .LVU17
  25:.././simpleserial/simpleserial.c **** 		for (k = 0; k < 8; k++) {
  87              		.loc 1 25 7 is_stmt 0 view .LVU18
  88 0012 0822     		movs	r2, #8
  89              	.LVL9:
  90              	.L6:
  27:.././simpleserial/simpleserial.c **** 		}
  91              		.loc 1 27 4 is_stmt 1 view .LVU19
  27:.././simpleserial/simpleserial.c **** 		}
  92              		.loc 1 27 8 is_stmt 0 view .LVU20
  93 0014 10F0800F 		tst	r0, #128
  94 0018 4FEA4000 		lsl	r0, r0, #1
  95              	.LVL10:
  27:.././simpleserial/simpleserial.c **** 		}
  96              		.loc 1 27 34 view .LVU21
  97 001c 18BF     		it	ne
  98 001e 80F04D00 		eorne	r0, r0, #77
  26:.././simpleserial/simpleserial.c **** 			crc = crc & 0x80 ? (crc << 1) ^ CW_CRC: crc << 1;
  99              		.loc 1 26 3 view .LVU22
 100 0022 013A     		subs	r2, r2, #1
 101              	.LVL11:
  27:.././simpleserial/simpleserial.c **** 		}
 102              		.loc 1 27 8 view .LVU23
 103 0024 C0B2     		uxtb	r0, r0
 104              	.LVL12:
  26:.././simpleserial/simpleserial.c **** 			crc = crc & 0x80 ? (crc << 1) ^ CW_CRC: crc << 1;
 105              		.loc 1 26 22 is_stmt 1 view .LVU24
  26:.././simpleserial/simpleserial.c **** 			crc = crc & 0x80 ? (crc << 1) ^ CW_CRC: crc << 1;
 106              		.loc 1 26 15 view .LVU25
  26:.././simpleserial/simpleserial.c **** 			crc = crc & 0x80 ? (crc << 1) ^ CW_CRC: crc << 1;
 107              		.loc 1 26 3 is_stmt 0 view .LVU26
 108 0026 F5D1     		bne	.L6
 109 0028 EDE7     		b	.L3
 110              		.cfi_endproc
 111              	.LFE0:
 113              		.section	.text.hex_decode,"ax",%progbits
 114              		.align	1
 115              		.global	hex_decode
 116              		.syntax unified
 117              		.thumb
 118              		.thumb_func
 119              		.fpu softvfp
 121              	hex_decode:
 122              	.LVL13:
 123              	.LFB4:
 237:.././simpleserial/simpleserial.c **** 
 238:.././simpleserial/simpleserial.c **** uint8_t ss_num_commands(uint8_t *x, uint8_t len)
 239:.././simpleserial/simpleserial.c **** {
 240:.././simpleserial/simpleserial.c ****     uint8_t ncmds = num_commands & 0xFF;
 241:.././simpleserial/simpleserial.c ****     simpleserial_put('r', 0x01, &ncmds);
 242:.././simpleserial/simpleserial.c ****     return 0x00;
 243:.././simpleserial/simpleserial.c **** }
 244:.././simpleserial/simpleserial.c **** 
 245:.././simpleserial/simpleserial.c **** typedef struct ss_cmd_repr {
 246:.././simpleserial/simpleserial.c ****     uint8_t c;
 247:.././simpleserial/simpleserial.c ****     uint8_t len;
 248:.././simpleserial/simpleserial.c ****     uint8_t flags;
 249:.././simpleserial/simpleserial.c **** } ss_cmd_repr;
 250:.././simpleserial/simpleserial.c **** 
 251:.././simpleserial/simpleserial.c **** uint8_t ss_get_commands(uint8_t *x, uint8_t len)
 252:.././simpleserial/simpleserial.c **** {
 253:.././simpleserial/simpleserial.c ****     ss_cmd_repr repr_cmd_buf[MAX_SS_CMDS];
 254:.././simpleserial/simpleserial.c ****     for (uint8_t i = 0; i < (num_commands & 0xFF); i++) {
 255:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 256:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].len = commands[i].len;
 257:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].flags = commands[i].flags;
 258:.././simpleserial/simpleserial.c ****     }
 259:.././simpleserial/simpleserial.c **** 
 260:.././simpleserial/simpleserial.c ****     simpleserial_put('r', num_commands * 0x03, (void *) repr_cmd_buf);
 261:.././simpleserial/simpleserial.c ****     return 0x00;
 262:.././simpleserial/simpleserial.c **** }
 263:.././simpleserial/simpleserial.c **** 
 264:.././simpleserial/simpleserial.c **** static char hex_lookup[16] =
 265:.././simpleserial/simpleserial.c **** {
 266:.././simpleserial/simpleserial.c **** 	'0', '1', '2', '3', '4', '5', '6', '7',
 267:.././simpleserial/simpleserial.c **** 	'8', '9', 'A', 'B', 'C', 'D', 'E', 'F'
 268:.././simpleserial/simpleserial.c **** };
 269:.././simpleserial/simpleserial.c **** 
 270:.././simpleserial/simpleserial.c **** int hex_decode(int len, char* ascii_buf, uint8_t* data_buf)
 271:.././simpleserial/simpleserial.c **** {
 124              		.loc 1 271 1 is_stmt 1 view -0
 125              		.cfi_startproc
 126              		@ args = 0, pretend = 0, frame = 0
 127              		@ frame_needed = 0, uses_anonymous_args = 0
 272:.././simpleserial/simpleserial.c **** 	for(int i = 0; i < len; i++)
 128              		.loc 1 272 2 view .LVU28
 129              	.LBB2:
 130              		.loc 1 272 6 view .LVU29
 131              		.loc 1 272 6 is_stmt 0 view .LVU30
 132              	.LBE2:
 271:.././simpleserial/simpleserial.c **** 	for(int i = 0; i < len; i++)
 133              		.loc 1 271 1 view .LVU31
 134 0000 F0B5     		push	{r4, r5, r6, r7, lr}
 135              	.LCFI0:
 136              		.cfi_def_cfa_offset 20
 137              		.cfi_offset 4, -20
 138              		.cfi_offset 5, -16
 139              		.cfi_offset 6, -12
 140              		.cfi_offset 7, -8
 141              		.cfi_offset 14, -4
 142              	.LBB7:
 143              		.loc 1 272 10 view .LVU32
 144 0002 0023     		movs	r3, #0
 145              	.LBB3:
 273:.././simpleserial/simpleserial.c **** 	{
 274:.././simpleserial/simpleserial.c **** 		char n_hi = ascii_buf[2*i];
 275:.././simpleserial/simpleserial.c **** 		char n_lo = ascii_buf[2*i+1];
 146              		.loc 1 275 8 view .LVU33
 147 0004 4F1C     		adds	r7, r1, #1
 148              	.LVL14:
 149              	.L10:
 150              		.loc 1 275 8 view .LVU34
 151              	.LBE3:
 272:.././simpleserial/simpleserial.c **** 	{
 152              		.loc 1 272 17 is_stmt 1 discriminator 1 view .LVU35
 272:.././simpleserial/simpleserial.c **** 	{
 153              		.loc 1 272 2 is_stmt 0 discriminator 1 view .LVU36
 154 0006 8342     		cmp	r3, r0
 155 0008 01DB     		blt	.L20
 156              	.LBE7:
 276:.././simpleserial/simpleserial.c **** 
 277:.././simpleserial/simpleserial.c **** 		if(n_lo >= '0' && n_lo <= '9')
 278:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - '0';
 279:.././simpleserial/simpleserial.c **** 		else if(n_lo >= 'A' && n_lo <= 'F')
 280:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - 'A' + 10;
 281:.././simpleserial/simpleserial.c **** 		else if(n_lo >= 'a' && n_lo <= 'f')
 282:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - 'a' + 10;
 283:.././simpleserial/simpleserial.c **** 		else
 284:.././simpleserial/simpleserial.c **** 			return 1;
 285:.././simpleserial/simpleserial.c **** 
 286:.././simpleserial/simpleserial.c **** 		if(n_hi >= '0' && n_hi <= '9')
 287:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - '0') << 4;
 288:.././simpleserial/simpleserial.c **** 		else if(n_hi >= 'A' && n_hi <= 'F')
 289:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - 'A' + 10) << 4;
 290:.././simpleserial/simpleserial.c **** 		else if(n_hi >= 'a' && n_hi <= 'f')
 291:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - 'a' + 10) << 4;
 292:.././simpleserial/simpleserial.c **** 		else
 293:.././simpleserial/simpleserial.c **** 			return 1;
 294:.././simpleserial/simpleserial.c **** 	}
 295:.././simpleserial/simpleserial.c **** 
 296:.././simpleserial/simpleserial.c **** 	return 0;
 157              		.loc 1 296 9 view .LVU37
 158 000a 0020     		movs	r0, #0
 159              	.LVL15:
 160              		.loc 1 296 9 view .LVU38
 161 000c 20E0     		b	.L9
 162              	.LVL16:
 163              	.L20:
 164              	.LBB8:
 165              	.LBB4:
 274:.././simpleserial/simpleserial.c **** 		char n_lo = ascii_buf[2*i+1];
 166              		.loc 1 274 3 is_stmt 1 view .LVU39
 275:.././simpleserial/simpleserial.c **** 
 167              		.loc 1 275 8 is_stmt 0 view .LVU40
 168 000e 17F81350 		ldrb	r5, [r7, r3, lsl #1]	@ zero_extendqisi2
 274:.././simpleserial/simpleserial.c **** 		char n_lo = ascii_buf[2*i+1];
 169              		.loc 1 274 8 view .LVU41
 170 0012 11F81340 		ldrb	r4, [r1, r3, lsl #1]	@ zero_extendqisi2
 171              	.LVL17:
 275:.././simpleserial/simpleserial.c **** 
 172              		.loc 1 275 3 is_stmt 1 view .LVU42
 277:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - '0';
 173              		.loc 1 277 3 view .LVU43
 277:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - '0';
 174              		.loc 1 277 18 is_stmt 0 view .LVU44
 175 0016 A5F13006 		sub	r6, r5, #48
 176 001a F6B2     		uxtb	r6, r6
 277:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - '0';
 177              		.loc 1 277 5 view .LVU45
 178 001c 092E     		cmp	r6, #9
 179 001e 0BD8     		bhi	.L11
 278:.././simpleserial/simpleserial.c **** 		else if(n_lo >= 'A' && n_lo <= 'F')
 180              		.loc 1 278 4 is_stmt 1 view .LVU46
 278:.././simpleserial/simpleserial.c **** 		else if(n_lo >= 'A' && n_lo <= 'F')
 181              		.loc 1 278 16 is_stmt 0 view .LVU47
 182 0020 D654     		strb	r6, [r2, r3]
 183              	.LVL18:
 184              	.L12:
 286:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - '0') << 4;
 185              		.loc 1 286 3 is_stmt 1 view .LVU48
 286:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - '0') << 4;
 186              		.loc 1 286 18 is_stmt 0 view .LVU49
 187 0022 A4F13005 		sub	r5, r4, #48
 286:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - '0') << 4;
 188              		.loc 1 286 5 view .LVU50
 189 0026 EEB2     		uxtb	r6, r5
 190 0028 092E     		cmp	r6, #9
 191 002a 14D8     		bhi	.L16
 192              	.L23:
 289:.././simpleserial/simpleserial.c **** 		else if(n_hi >= 'a' && n_hi <= 'f')
 193              		.loc 1 289 16 view .LVU51
 194 002c D45C     		ldrb	r4, [r2, r3]	@ zero_extendqisi2
 195              	.LVL19:
 289:.././simpleserial/simpleserial.c **** 		else if(n_hi >= 'a' && n_hi <= 'f')
 196              		.loc 1 289 16 view .LVU52
 197 002e 44EA0514 		orr	r4, r4, r5, lsl #4
 198              	.L22:
 291:.././simpleserial/simpleserial.c **** 		else
 199              		.loc 1 291 16 view .LVU53
 200 0032 D454     		strb	r4, [r2, r3]
 201              	.LBE4:
 272:.././simpleserial/simpleserial.c **** 	{
 202              		.loc 1 272 26 is_stmt 1 view .LVU54
 272:.././simpleserial/simpleserial.c **** 	{
 203              		.loc 1 272 27 is_stmt 0 view .LVU55
 204 0034 0133     		adds	r3, r3, #1
 205              	.LVL20:
 272:.././simpleserial/simpleserial.c **** 	{
 206              		.loc 1 272 27 view .LVU56
 207 0036 E6E7     		b	.L10
 208              	.LVL21:
 209              	.L11:
 210              	.LBB5:
 279:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - 'A' + 10;
 211              		.loc 1 279 8 is_stmt 1 view .LVU57
 279:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - 'A' + 10;
 212              		.loc 1 279 10 is_stmt 0 view .LVU58
 213 0038 A5F14106 		sub	r6, r5, #65
 214 003c 052E     		cmp	r6, #5
 215 003e 02D8     		bhi	.L13
 280:.././simpleserial/simpleserial.c **** 		else if(n_lo >= 'a' && n_lo <= 'f')
 216              		.loc 1 280 4 is_stmt 1 view .LVU59
 280:.././simpleserial/simpleserial.c **** 		else if(n_lo >= 'a' && n_lo <= 'f')
 217              		.loc 1 280 29 is_stmt 0 view .LVU60
 218 0040 373D     		subs	r5, r5, #55
 219              	.LVL22:
 220              	.L21:
 282:.././simpleserial/simpleserial.c **** 		else
 221              		.loc 1 282 16 view .LVU61
 222 0042 D554     		strb	r5, [r2, r3]
 223              	.LVL23:
 282:.././simpleserial/simpleserial.c **** 		else
 224              		.loc 1 282 16 view .LVU62
 225 0044 EDE7     		b	.L12
 226              	.LVL24:
 227              	.L13:
 281:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - 'a' + 10;
 228              		.loc 1 281 8 is_stmt 1 view .LVU63
 281:.././simpleserial/simpleserial.c **** 			data_buf[i] = n_lo - 'a' + 10;
 229              		.loc 1 281 10 is_stmt 0 view .LVU64
 230 0046 A5F16106 		sub	r6, r5, #97
 231 004a 052E     		cmp	r6, #5
 232 004c 01D9     		bls	.L14
 233              	.LVL25:
 234              	.L19:
 284:.././simpleserial/simpleserial.c **** 
 235              		.loc 1 284 11 view .LVU65
 236 004e 0120     		movs	r0, #1
 237              	.LVL26:
 238              	.L9:
 284:.././simpleserial/simpleserial.c **** 
 239              		.loc 1 284 11 view .LVU66
 240              	.LBE5:
 241              	.LBE8:
 297:.././simpleserial/simpleserial.c **** }
 242              		.loc 1 297 1 view .LVU67
 243 0050 F0BD     		pop	{r4, r5, r6, r7, pc}
 244              	.LVL27:
 245              	.L14:
 246              	.LBB9:
 247              	.LBB6:
 282:.././simpleserial/simpleserial.c **** 		else
 248              		.loc 1 282 4 is_stmt 1 view .LVU68
 282:.././simpleserial/simpleserial.c **** 		else
 249              		.loc 1 282 29 is_stmt 0 view .LVU69
 250 0052 573D     		subs	r5, r5, #87
 251              	.LVL28:
 282:.././simpleserial/simpleserial.c **** 		else
 252              		.loc 1 282 29 view .LVU70
 253 0054 F5E7     		b	.L21
 254              	.LVL29:
 255              	.L16:
 288:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - 'A' + 10) << 4;
 256              		.loc 1 288 8 is_stmt 1 view .LVU71
 288:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - 'A' + 10) << 4;
 257              		.loc 1 288 10 is_stmt 0 view .LVU72
 258 0056 A4F14105 		sub	r5, r4, #65
 259 005a 052D     		cmp	r5, #5
 260 005c 02D8     		bhi	.L18
 289:.././simpleserial/simpleserial.c **** 		else if(n_hi >= 'a' && n_hi <= 'f')
 261              		.loc 1 289 4 is_stmt 1 view .LVU73
 289:.././simpleserial/simpleserial.c **** 		else if(n_hi >= 'a' && n_hi <= 'f')
 262              		.loc 1 289 31 is_stmt 0 view .LVU74
 263 005e A4F13705 		sub	r5, r4, #55
 264 0062 E3E7     		b	.L23
 265              	.L18:
 290:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - 'a' + 10) << 4;
 266              		.loc 1 290 8 is_stmt 1 view .LVU75
 290:.././simpleserial/simpleserial.c **** 			data_buf[i] |= (n_hi - 'a' + 10) << 4;
 267              		.loc 1 290 10 is_stmt 0 view .LVU76
 268 0064 A4F16105 		sub	r5, r4, #97
 269 0068 052D     		cmp	r5, #5
 270 006a F0D8     		bhi	.L19
 291:.././simpleserial/simpleserial.c **** 		else
 271              		.loc 1 291 4 is_stmt 1 view .LVU77
 291:.././simpleserial/simpleserial.c **** 		else
 272              		.loc 1 291 16 is_stmt 0 view .LVU78
 273 006c D55C     		ldrb	r5, [r2, r3]	@ zero_extendqisi2
 291:.././simpleserial/simpleserial.c **** 		else
 274              		.loc 1 291 31 view .LVU79
 275 006e 573C     		subs	r4, r4, #87
 276              	.LVL30:
 291:.././simpleserial/simpleserial.c **** 		else
 277              		.loc 1 291 16 view .LVU80
 278 0070 45EA0414 		orr	r4, r5, r4, lsl #4
 279              	.LVL31:
 291:.././simpleserial/simpleserial.c **** 		else
 280              		.loc 1 291 16 view .LVU81
 281 0074 DDE7     		b	.L22
 282              	.LBE6:
 283              	.LBE9:
 284              		.cfi_endproc
 285              	.LFE4:
 287              		.section	.text.simpleserial_addcmd_flags,"ax",%progbits
 288              		.align	1
 289              		.global	simpleserial_addcmd_flags
 290              		.syntax unified
 291              		.thumb
 292              		.thumb_func
 293              		.fpu softvfp
 295              	simpleserial_addcmd_flags:
 296              	.LVL32:
 297              	.LFB7:
 298:.././simpleserial/simpleserial.c **** 
 299:.././simpleserial/simpleserial.c **** 
 300:.././simpleserial/simpleserial.c **** 
 301:.././simpleserial/simpleserial.c **** // Set up the SimpleSerial module by preparing internal commands
 302:.././simpleserial/simpleserial.c **** // This just adds the "v" command for now...
 303:.././simpleserial/simpleserial.c **** void simpleserial_init()
 304:.././simpleserial/simpleserial.c **** {
 305:.././simpleserial/simpleserial.c **** 	simpleserial_addcmd('v', 0, check_version);
 306:.././simpleserial/simpleserial.c ****     simpleserial_addcmd('w', 0, ss_get_commands);
 307:.././simpleserial/simpleserial.c ****     simpleserial_addcmd('y', 0, ss_num_commands);
 308:.././simpleserial/simpleserial.c **** }
 309:.././simpleserial/simpleserial.c **** 
 310:.././simpleserial/simpleserial.c **** int simpleserial_addcmd(char c, unsigned int len, uint8_t (*fp)(uint8_t*, uint8_t))
 311:.././simpleserial/simpleserial.c **** {
 312:.././simpleserial/simpleserial.c **** 	return simpleserial_addcmd_flags(c, len, fp, CMD_FLAG_NONE);
 313:.././simpleserial/simpleserial.c **** }
 314:.././simpleserial/simpleserial.c **** 
 315:.././simpleserial/simpleserial.c **** int simpleserial_addcmd_flags(char c, unsigned int len, uint8_t (*fp)(uint8_t*, uint8_t), uint8_t f
 316:.././simpleserial/simpleserial.c **** {
 298              		.loc 1 316 1 is_stmt 1 view -0
 299              		.cfi_startproc
 300              		@ args = 0, pretend = 0, frame = 0
 301              		@ frame_needed = 0, uses_anonymous_args = 0
 317:.././simpleserial/simpleserial.c **** 	if(num_commands >= MAX_SS_CMDS)
 302              		.loc 1 317 2 view .LVU83
 316:.././simpleserial/simpleserial.c **** 	if(num_commands >= MAX_SS_CMDS)
 303              		.loc 1 316 1 is_stmt 0 view .LVU84
 304 0000 70B5     		push	{r4, r5, r6, lr}
 305              	.LCFI1:
 306              		.cfi_def_cfa_offset 16
 307              		.cfi_offset 4, -16
 308              		.cfi_offset 5, -12
 309              		.cfi_offset 6, -8
 310              		.cfi_offset 14, -4
 311              		.loc 1 317 18 view .LVU85
 312 0002 094E     		ldr	r6, .L28
 313 0004 3468     		ldr	r4, [r6]
 314              		.loc 1 317 4 view .LVU86
 315 0006 0F2C     		cmp	r4, #15
 316 0008 0BDC     		bgt	.L27
 318:.././simpleserial/simpleserial.c **** 		return 1;
 319:.././simpleserial/simpleserial.c **** 
 320:.././simpleserial/simpleserial.c **** 	if(len >= MAX_SS_LEN)
 317              		.loc 1 320 2 is_stmt 1 view .LVU87
 318              		.loc 1 320 4 is_stmt 0 view .LVU88
 319 000a BF29     		cmp	r1, #191
 320 000c 09D8     		bhi	.L27
 321:.././simpleserial/simpleserial.c **** 		return 1;
 322:.././simpleserial/simpleserial.c **** 
 323:.././simpleserial/simpleserial.c **** 	commands[num_commands].c   = c;
 321              		.loc 1 323 2 is_stmt 1 view .LVU89
 322              		.loc 1 323 29 is_stmt 0 view .LVU90
 323 000e 06EB0415 		add	r5, r6, r4, lsl #4
 324:.././simpleserial/simpleserial.c **** 	commands[num_commands].len = len;
 325:.././simpleserial/simpleserial.c **** 	commands[num_commands].fp  = fp;
 324              		.loc 1 325 29 view .LVU91
 325 0012 C5E90212 		strd	r1, r2, [r5, #8]
 326:.././simpleserial/simpleserial.c **** 	commands[num_commands].flags = fl;
 327:.././simpleserial/simpleserial.c **** 	num_commands++;
 326              		.loc 1 327 14 view .LVU92
 327 0016 0134     		adds	r4, r4, #1
 323:.././simpleserial/simpleserial.c **** 	commands[num_commands].len = len;
 328              		.loc 1 323 29 view .LVU93
 329 0018 2871     		strb	r0, [r5, #4]
 324:.././simpleserial/simpleserial.c **** 	commands[num_commands].len = len;
 330              		.loc 1 324 2 is_stmt 1 view .LVU94
 326:.././simpleserial/simpleserial.c **** 	commands[num_commands].flags = fl;
 331              		.loc 1 326 2 view .LVU95
 326:.././simpleserial/simpleserial.c **** 	commands[num_commands].flags = fl;
 332              		.loc 1 326 31 is_stmt 0 view .LVU96
 333 001a 2B74     		strb	r3, [r5, #16]
 334              		.loc 1 327 2 is_stmt 1 view .LVU97
 335              		.loc 1 327 14 is_stmt 0 view .LVU98
 336 001c 3460     		str	r4, [r6]
 328:.././simpleserial/simpleserial.c **** 
 329:.././simpleserial/simpleserial.c **** 	return 0;
 337              		.loc 1 329 2 is_stmt 1 view .LVU99
 338              		.loc 1 329 9 is_stmt 0 view .LVU100
 339 001e 0020     		movs	r0, #0
 340              	.LVL33:
 341              	.L24:
 330:.././simpleserial/simpleserial.c **** }
 342              		.loc 1 330 1 view .LVU101
 343 0020 70BD     		pop	{r4, r5, r6, pc}
 344              	.LVL34:
 345              	.L27:
 318:.././simpleserial/simpleserial.c **** 
 346              		.loc 1 318 10 view .LVU102
 347 0022 0120     		movs	r0, #1
 348              	.LVL35:
 318:.././simpleserial/simpleserial.c **** 
 349              		.loc 1 318 10 view .LVU103
 350 0024 FCE7     		b	.L24
 351              	.L29:
 352 0026 00BF     		.align	2
 353              	.L28:
 354 0028 00000000 		.word	.LANCHOR0
 355              		.cfi_endproc
 356              	.LFE7:
 358              		.section	.text.simpleserial_addcmd,"ax",%progbits
 359              		.align	1
 360              		.global	simpleserial_addcmd
 361              		.syntax unified
 362              		.thumb
 363              		.thumb_func
 364              		.fpu softvfp
 366              	simpleserial_addcmd:
 367              	.LVL36:
 368              	.LFB6:
 311:.././simpleserial/simpleserial.c **** 	return simpleserial_addcmd_flags(c, len, fp, CMD_FLAG_NONE);
 369              		.loc 1 311 1 is_stmt 1 view -0
 370              		.cfi_startproc
 371              		@ args = 0, pretend = 0, frame = 0
 372              		@ frame_needed = 0, uses_anonymous_args = 0
 373              		@ link register save eliminated.
 312:.././simpleserial/simpleserial.c **** }
 374              		.loc 1 312 2 view .LVU105
 312:.././simpleserial/simpleserial.c **** }
 375              		.loc 1 312 9 is_stmt 0 view .LVU106
 376 0000 0023     		movs	r3, #0
 377 0002 FFF7FEBF 		b	simpleserial_addcmd_flags
 378              	.LVL37:
 312:.././simpleserial/simpleserial.c **** }
 379              		.loc 1 312 9 view .LVU107
 380              		.cfi_endproc
 381              	.LFE6:
 383              		.section	.text.simpleserial_init,"ax",%progbits
 384              		.align	1
 385              		.global	simpleserial_init
 386              		.syntax unified
 387              		.thumb
 388              		.thumb_func
 389              		.fpu softvfp
 391              	simpleserial_init:
 392              	.LFB5:
 304:.././simpleserial/simpleserial.c **** 	simpleserial_addcmd('v', 0, check_version);
 393              		.loc 1 304 1 is_stmt 1 view -0
 394              		.cfi_startproc
 395              		@ args = 0, pretend = 0, frame = 0
 396              		@ frame_needed = 0, uses_anonymous_args = 0
 305:.././simpleserial/simpleserial.c ****     simpleserial_addcmd('w', 0, ss_get_commands);
 397              		.loc 1 305 2 view .LVU109
 304:.././simpleserial/simpleserial.c **** 	simpleserial_addcmd('v', 0, check_version);
 398              		.loc 1 304 1 is_stmt 0 view .LVU110
 399 0000 08B5     		push	{r3, lr}
 400              	.LCFI2:
 401              		.cfi_def_cfa_offset 8
 402              		.cfi_offset 3, -8
 403              		.cfi_offset 14, -4
 305:.././simpleserial/simpleserial.c ****     simpleserial_addcmd('w', 0, ss_get_commands);
 404              		.loc 1 305 2 view .LVU111
 405 0002 084A     		ldr	r2, .L32
 406 0004 0021     		movs	r1, #0
 407 0006 7620     		movs	r0, #118
 408 0008 FFF7FEFF 		bl	simpleserial_addcmd
 409              	.LVL38:
 306:.././simpleserial/simpleserial.c ****     simpleserial_addcmd('y', 0, ss_num_commands);
 410              		.loc 1 306 5 is_stmt 1 view .LVU112
 411 000c 064A     		ldr	r2, .L32+4
 412 000e 0021     		movs	r1, #0
 413 0010 7720     		movs	r0, #119
 414 0012 FFF7FEFF 		bl	simpleserial_addcmd
 415              	.LVL39:
 307:.././simpleserial/simpleserial.c **** }
 416              		.loc 1 307 5 view .LVU113
 308:.././simpleserial/simpleserial.c **** 
 417              		.loc 1 308 1 is_stmt 0 view .LVU114
 418 0016 BDE80840 		pop	{r3, lr}
 419              	.LCFI3:
 420              		.cfi_restore 14
 421              		.cfi_restore 3
 422              		.cfi_def_cfa_offset 0
 307:.././simpleserial/simpleserial.c **** }
 423              		.loc 1 307 5 view .LVU115
 424 001a 044A     		ldr	r2, .L32+8
 425 001c 0021     		movs	r1, #0
 426 001e 7920     		movs	r0, #121
 427 0020 FFF7FEBF 		b	simpleserial_addcmd
 428              	.LVL40:
 429              	.L33:
 430              		.align	2
 431              	.L32:
 432 0024 00000000 		.word	check_version
 433 0028 00000000 		.word	ss_get_commands
 434 002c 00000000 		.word	ss_num_commands
 435              		.cfi_endproc
 436              	.LFE5:
 438              		.section	.text.simpleserial_get,"ax",%progbits
 439              		.align	1
 440              		.global	simpleserial_get
 441              		.syntax unified
 442              		.thumb
 443              		.thumb_func
 444              		.fpu softvfp
 446              	simpleserial_get:
 447              	.LFB8:
 331:.././simpleserial/simpleserial.c **** 
 332:.././simpleserial/simpleserial.c **** void simpleserial_get(void)
 333:.././simpleserial/simpleserial.c **** {
 448              		.loc 1 333 1 is_stmt 1 view -0
 449              		.cfi_startproc
 450              		@ args = 0, pretend = 0, frame = 576
 451              		@ frame_needed = 0, uses_anonymous_args = 0
 334:.././simpleserial/simpleserial.c **** 	char ascii_buf[2*MAX_SS_LEN];
 452              		.loc 1 334 2 view .LVU117
 335:.././simpleserial/simpleserial.c **** 	uint8_t data_buf[MAX_SS_LEN];
 453              		.loc 1 335 2 view .LVU118
 336:.././simpleserial/simpleserial.c **** 	char c;
 454              		.loc 1 336 2 view .LVU119
 337:.././simpleserial/simpleserial.c **** 
 338:.././simpleserial/simpleserial.c **** 	// Find which command we're receiving
 339:.././simpleserial/simpleserial.c **** 	c = getch();
 455              		.loc 1 339 2 view .LVU120
 333:.././simpleserial/simpleserial.c **** 	char ascii_buf[2*MAX_SS_LEN];
 456              		.loc 1 333 1 is_stmt 0 view .LVU121
 457 0000 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 458              	.LCFI4:
 459              		.cfi_def_cfa_offset 24
 460              		.cfi_offset 4, -24
 461              		.cfi_offset 5, -20
 462              		.cfi_offset 6, -16
 463              		.cfi_offset 7, -12
 464              		.cfi_offset 8, -8
 465              		.cfi_offset 14, -4
 340:.././simpleserial/simpleserial.c **** 
 341:.././simpleserial/simpleserial.c **** 	int cmd;
 342:.././simpleserial/simpleserial.c **** 	for(cmd = 0; cmd < num_commands; cmd++)
 466              		.loc 1 342 19 view .LVU122
 467 0004 2A4C     		ldr	r4, .L57
 333:.././simpleserial/simpleserial.c **** 	char ascii_buf[2*MAX_SS_LEN];
 468              		.loc 1 333 1 view .LVU123
 469 0006 ADF5107D 		sub	sp, sp, #576
 470              	.LCFI5:
 471              		.cfi_def_cfa_offset 600
 339:.././simpleserial/simpleserial.c **** 
 472              		.loc 1 339 6 view .LVU124
 473 000a FFF7FEFF 		bl	getch
 474              	.LVL41:
 341:.././simpleserial/simpleserial.c **** 	for(cmd = 0; cmd < num_commands; cmd++)
 475              		.loc 1 341 2 is_stmt 1 view .LVU125
 476              		.loc 1 342 2 view .LVU126
 477              		.loc 1 342 19 is_stmt 0 view .LVU127
 478 000e 2268     		ldr	r2, [r4]
 479              		.loc 1 342 10 view .LVU128
 480 0010 0023     		movs	r3, #0
 343:.././simpleserial/simpleserial.c **** 	{
 344:.././simpleserial/simpleserial.c **** 		if(commands[cmd].c == c)
 481              		.loc 1 344 19 view .LVU129
 482 0012 211D     		adds	r1, r4, #4
 483              	.LVL42:
 484              	.L35:
 342:.././simpleserial/simpleserial.c **** 	{
 485              		.loc 1 342 15 is_stmt 1 discriminator 1 view .LVU130
 342:.././simpleserial/simpleserial.c **** 	{
 486              		.loc 1 342 2 is_stmt 0 discriminator 1 view .LVU131
 487 0014 9A42     		cmp	r2, r3
 488 0016 04DC     		bgt	.L39
 345:.././simpleserial/simpleserial.c **** 			break;
 346:.././simpleserial/simpleserial.c **** 	}
 347:.././simpleserial/simpleserial.c **** 
 348:.././simpleserial/simpleserial.c **** 	// If we didn't find a match, give up right away
 349:.././simpleserial/simpleserial.c **** 	if(cmd == num_commands)
 489              		.loc 1 349 2 is_stmt 1 view .LVU132
 490              		.loc 1 349 4 is_stmt 0 view .LVU133
 491 0018 07D1     		bne	.L41
 492              	.LVL43:
 493              	.L34:
 350:.././simpleserial/simpleserial.c **** 		return;
 351:.././simpleserial/simpleserial.c **** 
 352:.././simpleserial/simpleserial.c **** 	// If flag CMD_FLAG_LEN is set, the next byte indicates the sent length
 353:.././simpleserial/simpleserial.c **** 	if ((commands[cmd].flags & CMD_FLAG_LEN) != 0)
 354:.././simpleserial/simpleserial.c **** 	{
 355:.././simpleserial/simpleserial.c **** 		uint8_t l = 0;
 356:.././simpleserial/simpleserial.c **** 		char buff[2];
 357:.././simpleserial/simpleserial.c **** 		buff[0] = getch();
 358:.././simpleserial/simpleserial.c **** 		buff[1] = getch();
 359:.././simpleserial/simpleserial.c **** 		if (hex_decode(1, buff, &l))
 360:.././simpleserial/simpleserial.c **** 			return;
 361:.././simpleserial/simpleserial.c **** 		commands[cmd].len = l;
 362:.././simpleserial/simpleserial.c **** 	}
 363:.././simpleserial/simpleserial.c **** 
 364:.././simpleserial/simpleserial.c **** 	// Receive characters until we fill the ASCII buffer
 365:.././simpleserial/simpleserial.c **** 	for(int i = 0; i < 2*commands[cmd].len; i++)
 366:.././simpleserial/simpleserial.c **** 	{
 367:.././simpleserial/simpleserial.c **** 		c = getch();
 368:.././simpleserial/simpleserial.c **** 
 369:.././simpleserial/simpleserial.c **** 		// Check for early \n
 370:.././simpleserial/simpleserial.c **** 		if(c == '\n' || c == '\r')
 371:.././simpleserial/simpleserial.c **** 			return;
 372:.././simpleserial/simpleserial.c **** 
 373:.././simpleserial/simpleserial.c **** 		ascii_buf[i] = c;
 374:.././simpleserial/simpleserial.c **** 	}
 375:.././simpleserial/simpleserial.c **** 
 376:.././simpleserial/simpleserial.c **** 	// Assert that last character is \n or \r
 377:.././simpleserial/simpleserial.c **** 	c = getch();
 378:.././simpleserial/simpleserial.c **** 	if(c != '\n' && c != '\r')
 379:.././simpleserial/simpleserial.c **** 		return;
 380:.././simpleserial/simpleserial.c **** 
 381:.././simpleserial/simpleserial.c **** 	// ASCII buffer is full: convert to bytes
 382:.././simpleserial/simpleserial.c **** 	// Check for illegal characters here
 383:.././simpleserial/simpleserial.c **** 	if(hex_decode(commands[cmd].len, ascii_buf, data_buf))
 384:.././simpleserial/simpleserial.c **** 		return;
 385:.././simpleserial/simpleserial.c **** 
 386:.././simpleserial/simpleserial.c **** 	// Callback
 387:.././simpleserial/simpleserial.c **** 	uint8_t ret[1];
 388:.././simpleserial/simpleserial.c **** 	ret[0] = commands[cmd].fp(data_buf, commands[cmd].len);
 389:.././simpleserial/simpleserial.c **** 
 390:.././simpleserial/simpleserial.c **** 	// Acknowledge (if version is 1.1)
 391:.././simpleserial/simpleserial.c **** #if SS_VER == SS_VER_1_1
 392:.././simpleserial/simpleserial.c **** 	simpleserial_put('z', 1, ret);
 393:.././simpleserial/simpleserial.c **** #endif
 394:.././simpleserial/simpleserial.c **** }
 494              		.loc 1 394 1 view .LVU134
 495 001a 0DF5107D 		add	sp, sp, #576
 496              	.LCFI6:
 497              		.cfi_remember_state
 498              		.cfi_def_cfa_offset 24
 499              		@ sp needed
 500 001e BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 501              	.LVL44:
 502              	.L39:
 503              	.LCFI7:
 504              		.cfi_restore_state
 344:.././simpleserial/simpleserial.c **** 			break;
 505              		.loc 1 344 3 is_stmt 1 view .LVU135
 344:.././simpleserial/simpleserial.c **** 			break;
 506              		.loc 1 344 19 is_stmt 0 view .LVU136
 507 0022 1D01     		lsls	r5, r3, #4
 344:.././simpleserial/simpleserial.c **** 			break;
 508              		.loc 1 344 5 view .LVU137
 509 0024 6D5C     		ldrb	r5, [r5, r1]	@ zero_extendqisi2
 510 0026 8542     		cmp	r5, r0
 511 0028 36D1     		bne	.L36
 512              	.L41:
 353:.././simpleserial/simpleserial.c **** 	{
 513              		.loc 1 353 2 is_stmt 1 view .LVU138
 353:.././simpleserial/simpleserial.c **** 	{
 514              		.loc 1 353 20 is_stmt 0 view .LVU139
 515 002a 04EB0315 		add	r5, r4, r3, lsl #4
 516 002e 1E01     		lsls	r6, r3, #4
 353:.././simpleserial/simpleserial.c **** 	{
 517              		.loc 1 353 5 view .LVU140
 518 0030 2B7C     		ldrb	r3, [r5, #16]	@ zero_extendqisi2
 519              	.LVL45:
 353:.././simpleserial/simpleserial.c **** 	{
 520              		.loc 1 353 5 view .LVU141
 521 0032 DB07     		lsls	r3, r3, #31
 522 0034 14D5     		bpl	.L38
 523              	.LBB10:
 355:.././simpleserial/simpleserial.c **** 		char buff[2];
 524              		.loc 1 355 3 is_stmt 1 view .LVU142
 355:.././simpleserial/simpleserial.c **** 		char buff[2];
 525              		.loc 1 355 11 is_stmt 0 view .LVU143
 526 0036 0023     		movs	r3, #0
 527 0038 8DF80030 		strb	r3, [sp]
 356:.././simpleserial/simpleserial.c **** 		buff[0] = getch();
 528              		.loc 1 356 3 is_stmt 1 view .LVU144
 357:.././simpleserial/simpleserial.c **** 		buff[1] = getch();
 529              		.loc 1 357 3 view .LVU145
 357:.././simpleserial/simpleserial.c **** 		buff[1] = getch();
 530              		.loc 1 357 13 is_stmt 0 view .LVU146
 531 003c FFF7FEFF 		bl	getch
 532              	.LVL46:
 357:.././simpleserial/simpleserial.c **** 		buff[1] = getch();
 533              		.loc 1 357 11 view .LVU147
 534 0040 8DF8C000 		strb	r0, [sp, #192]
 358:.././simpleserial/simpleserial.c **** 		if (hex_decode(1, buff, &l))
 535              		.loc 1 358 3 is_stmt 1 view .LVU148
 358:.././simpleserial/simpleserial.c **** 		if (hex_decode(1, buff, &l))
 536              		.loc 1 358 13 is_stmt 0 view .LVU149
 537 0044 FFF7FEFF 		bl	getch
 538              	.LVL47:
 359:.././simpleserial/simpleserial.c **** 			return;
 539              		.loc 1 359 7 view .LVU150
 540 0048 6A46     		mov	r2, sp
 358:.././simpleserial/simpleserial.c **** 		if (hex_decode(1, buff, &l))
 541              		.loc 1 358 11 view .LVU151
 542 004a 8DF8C100 		strb	r0, [sp, #193]
 359:.././simpleserial/simpleserial.c **** 			return;
 543              		.loc 1 359 3 is_stmt 1 view .LVU152
 359:.././simpleserial/simpleserial.c **** 			return;
 544              		.loc 1 359 7 is_stmt 0 view .LVU153
 545 004e 30A9     		add	r1, sp, #192
 546 0050 0120     		movs	r0, #1
 547 0052 FFF7FEFF 		bl	hex_decode
 548              	.LVL48:
 359:.././simpleserial/simpleserial.c **** 			return;
 549              		.loc 1 359 6 view .LVU154
 550 0056 0028     		cmp	r0, #0
 551 0058 DFD1     		bne	.L34
 361:.././simpleserial/simpleserial.c **** 	}
 552              		.loc 1 361 3 is_stmt 1 view .LVU155
 361:.././simpleserial/simpleserial.c **** 	}
 553              		.loc 1 361 21 is_stmt 0 view .LVU156
 554 005a 9DF80030 		ldrb	r3, [sp]	@ zero_extendqisi2
 555 005e AB60     		str	r3, [r5, #8]
 556              	.L38:
 557              	.LBE10:
 342:.././simpleserial/simpleserial.c **** 	{
 558              		.loc 1 342 10 discriminator 1 view .LVU157
 559 0060 0025     		movs	r5, #0
 560              	.LBB11:
 365:.././simpleserial/simpleserial.c **** 	{
 561              		.loc 1 365 36 discriminator 1 view .LVU158
 562 0062 A719     		adds	r7, r4, r6
 373:.././simpleserial/simpleserial.c **** 	}
 563              		.loc 1 373 16 discriminator 1 view .LVU159
 564 0064 0DF1C008 		add	r8, sp, #192
 565              	.L44:
 566              	.LVL49:
 365:.././simpleserial/simpleserial.c **** 	{
 567              		.loc 1 365 17 is_stmt 1 discriminator 1 view .LVU160
 365:.././simpleserial/simpleserial.c **** 	{
 568              		.loc 1 365 22 is_stmt 0 discriminator 1 view .LVU161
 569 0068 BB68     		ldr	r3, [r7, #8]
 365:.././simpleserial/simpleserial.c **** 	{
 570              		.loc 1 365 2 discriminator 1 view .LVU162
 571 006a B5EB430F 		cmp	r5, r3, lsl #1
 572 006e 15D3     		bcc	.L45
 573              	.LBE11:
 377:.././simpleserial/simpleserial.c **** 	if(c != '\n' && c != '\r')
 574              		.loc 1 377 2 is_stmt 1 view .LVU163
 377:.././simpleserial/simpleserial.c **** 	if(c != '\n' && c != '\r')
 575              		.loc 1 377 6 is_stmt 0 view .LVU164
 576 0070 FFF7FEFF 		bl	getch
 577              	.LVL50:
 378:.././simpleserial/simpleserial.c **** 		return;
 578              		.loc 1 378 2 is_stmt 1 view .LVU165
 378:.././simpleserial/simpleserial.c **** 		return;
 579              		.loc 1 378 4 is_stmt 0 view .LVU166
 580 0074 0A28     		cmp	r0, #10
 581 0076 01D0     		beq	.L46
 378:.././simpleserial/simpleserial.c **** 		return;
 582              		.loc 1 378 15 discriminator 1 view .LVU167
 583 0078 0D28     		cmp	r0, #13
 584 007a CED1     		bne	.L34
 585              	.L46:
 383:.././simpleserial/simpleserial.c **** 		return;
 586              		.loc 1 383 2 is_stmt 1 view .LVU168
 383:.././simpleserial/simpleserial.c **** 		return;
 587              		.loc 1 383 29 is_stmt 0 view .LVU169
 588 007c 3444     		add	r4, r4, r6
 383:.././simpleserial/simpleserial.c **** 		return;
 589              		.loc 1 383 5 view .LVU170
 590 007e 6A46     		mov	r2, sp
 383:.././simpleserial/simpleserial.c **** 		return;
 591              		.loc 1 383 29 view .LVU171
 592 0080 A568     		ldr	r5, [r4, #8]
 593              	.LVL51:
 383:.././simpleserial/simpleserial.c **** 		return;
 594              		.loc 1 383 5 view .LVU172
 595 0082 30A9     		add	r1, sp, #192
 596 0084 2846     		mov	r0, r5
 597              	.LVL52:
 383:.././simpleserial/simpleserial.c **** 		return;
 598              		.loc 1 383 5 view .LVU173
 599 0086 FFF7FEFF 		bl	hex_decode
 600              	.LVL53:
 383:.././simpleserial/simpleserial.c **** 		return;
 601              		.loc 1 383 4 view .LVU174
 602 008a 0028     		cmp	r0, #0
 603 008c C5D1     		bne	.L34
 387:.././simpleserial/simpleserial.c **** 	ret[0] = commands[cmd].fp(data_buf, commands[cmd].len);
 604              		.loc 1 387 2 is_stmt 1 view .LVU175
 388:.././simpleserial/simpleserial.c **** 
 605              		.loc 1 388 2 view .LVU176
 388:.././simpleserial/simpleserial.c **** 
 606              		.loc 1 388 11 is_stmt 0 view .LVU177
 607 008e E368     		ldr	r3, [r4, #12]
 608 0090 E9B2     		uxtb	r1, r5
 609 0092 6846     		mov	r0, sp
 610 0094 9847     		blx	r3
 611              	.LVL54:
 612 0096 C0E7     		b	.L34
 613              	.LVL55:
 614              	.L36:
 342:.././simpleserial/simpleserial.c **** 	{
 615              		.loc 1 342 35 is_stmt 1 discriminator 2 view .LVU178
 342:.././simpleserial/simpleserial.c **** 	{
 616              		.loc 1 342 38 is_stmt 0 discriminator 2 view .LVU179
 617 0098 0133     		adds	r3, r3, #1
 618              	.LVL56:
 342:.././simpleserial/simpleserial.c **** 	{
 619              		.loc 1 342 38 discriminator 2 view .LVU180
 620 009a BBE7     		b	.L35
 621              	.LVL57:
 622              	.L45:
 623              	.LBB12:
 367:.././simpleserial/simpleserial.c **** 
 624              		.loc 1 367 3 is_stmt 1 view .LVU181
 367:.././simpleserial/simpleserial.c **** 
 625              		.loc 1 367 7 is_stmt 0 view .LVU182
 626 009c FFF7FEFF 		bl	getch
 627              	.LVL58:
 370:.././simpleserial/simpleserial.c **** 			return;
 628              		.loc 1 370 3 is_stmt 1 view .LVU183
 370:.././simpleserial/simpleserial.c **** 			return;
 629              		.loc 1 370 5 is_stmt 0 view .LVU184
 630 00a0 0A28     		cmp	r0, #10
 631 00a2 BAD0     		beq	.L34
 370:.././simpleserial/simpleserial.c **** 			return;
 632              		.loc 1 370 16 discriminator 1 view .LVU185
 633 00a4 0D28     		cmp	r0, #13
 634 00a6 B8D0     		beq	.L34
 373:.././simpleserial/simpleserial.c **** 	}
 635              		.loc 1 373 3 is_stmt 1 discriminator 2 view .LVU186
 373:.././simpleserial/simpleserial.c **** 	}
 636              		.loc 1 373 16 is_stmt 0 discriminator 2 view .LVU187
 637 00a8 05F80800 		strb	r0, [r5, r8]
 365:.././simpleserial/simpleserial.c **** 	{
 638              		.loc 1 365 42 is_stmt 1 discriminator 2 view .LVU188
 365:.././simpleserial/simpleserial.c **** 	{
 639              		.loc 1 365 43 is_stmt 0 discriminator 2 view .LVU189
 640 00ac 0135     		adds	r5, r5, #1
 641              	.LVL59:
 365:.././simpleserial/simpleserial.c **** 	{
 642              		.loc 1 365 43 discriminator 2 view .LVU190
 643 00ae DBE7     		b	.L44
 644              	.L58:
 645              		.align	2
 646              	.L57:
 647 00b0 00000000 		.word	.LANCHOR0
 648              	.LBE12:
 649              		.cfi_endproc
 650              	.LFE8:
 652              		.section	.text.simpleserial_put,"ax",%progbits
 653              		.align	1
 654              		.global	simpleserial_put
 655              		.syntax unified
 656              		.thumb
 657              		.thumb_func
 658              		.fpu softvfp
 660              	simpleserial_put:
 661              	.LVL60:
 662              	.LFB9:
 395:.././simpleserial/simpleserial.c **** 
 396:.././simpleserial/simpleserial.c **** void simpleserial_put(char c, uint8_t size, uint8_t* output)
 397:.././simpleserial/simpleserial.c **** {
 663              		.loc 1 397 1 is_stmt 1 view -0
 664              		.cfi_startproc
 665              		@ args = 0, pretend = 0, frame = 0
 666              		@ frame_needed = 0, uses_anonymous_args = 0
 398:.././simpleserial/simpleserial.c **** 	// Write first character
 399:.././simpleserial/simpleserial.c **** 	putch(c);
 667              		.loc 1 399 2 view .LVU192
 397:.././simpleserial/simpleserial.c **** 	// Write first character
 668              		.loc 1 397 1 is_stmt 0 view .LVU193
 669 0000 F8B5     		push	{r3, r4, r5, r6, r7, lr}
 670              	.LCFI8:
 671              		.cfi_def_cfa_offset 24
 672              		.cfi_offset 3, -24
 673              		.cfi_offset 4, -20
 674              		.cfi_offset 5, -16
 675              		.cfi_offset 6, -12
 676              		.cfi_offset 7, -8
 677              		.cfi_offset 14, -4
 397:.././simpleserial/simpleserial.c **** 	// Write first character
 678              		.loc 1 397 1 view .LVU194
 679 0002 1446     		mov	r4, r2
 680 0004 0E46     		mov	r6, r1
 681              		.loc 1 399 2 view .LVU195
 682 0006 FFF7FEFF 		bl	putch
 683              	.LVL61:
 400:.././simpleserial/simpleserial.c **** 
 401:.././simpleserial/simpleserial.c **** 	// Write each byte as two nibbles
 402:.././simpleserial/simpleserial.c **** 	for(int i = 0; i < size; i++)
 684              		.loc 1 402 2 is_stmt 1 view .LVU196
 685              	.LBB13:
 686              		.loc 1 402 6 view .LVU197
 403:.././simpleserial/simpleserial.c **** 	{
 404:.././simpleserial/simpleserial.c **** 		putch(hex_lookup[output[i] >> 4 ]);
 687              		.loc 1 404 3 is_stmt 0 view .LVU198
 688 000a 0C4F     		ldr	r7, .L62
 689 000c 651E     		subs	r5, r4, #1
 402:.././simpleserial/simpleserial.c **** 	{
 690              		.loc 1 402 2 view .LVU199
 691 000e C4F10104 		rsb	r4, r4, #1
 692              	.LVL62:
 693              	.L60:
 402:.././simpleserial/simpleserial.c **** 	{
 694              		.loc 1 402 17 is_stmt 1 discriminator 1 view .LVU200
 402:.././simpleserial/simpleserial.c **** 	{
 695              		.loc 1 402 2 is_stmt 0 discriminator 1 view .LVU201
 696 0012 6319     		adds	r3, r4, r5
 697 0014 9E42     		cmp	r6, r3
 698 0016 04DC     		bgt	.L61
 699              	.LBE13:
 405:.././simpleserial/simpleserial.c **** 		putch(hex_lookup[output[i] & 0xF]);
 406:.././simpleserial/simpleserial.c **** 	}
 407:.././simpleserial/simpleserial.c **** 
 408:.././simpleserial/simpleserial.c **** 	// Write trailing '\n'
 409:.././simpleserial/simpleserial.c **** 	putch('\n');
 700              		.loc 1 409 2 is_stmt 1 view .LVU202
 410:.././simpleserial/simpleserial.c **** }
 701              		.loc 1 410 1 is_stmt 0 view .LVU203
 702 0018 BDE8F840 		pop	{r3, r4, r5, r6, r7, lr}
 703              	.LCFI9:
 704              		.cfi_remember_state
 705              		.cfi_restore 14
 706              		.cfi_restore 7
 707              		.cfi_restore 6
 708              		.cfi_restore 5
 709              		.cfi_restore 4
 710              		.cfi_restore 3
 711              		.cfi_def_cfa_offset 0
 409:.././simpleserial/simpleserial.c **** }
 712              		.loc 1 409 2 view .LVU204
 713 001c 0A20     		movs	r0, #10
 714 001e FFF7FEBF 		b	putch
 715              	.LVL63:
 716              	.L61:
 717              	.LCFI10:
 718              		.cfi_restore_state
 719              	.LBB14:
 404:.././simpleserial/simpleserial.c **** 		putch(hex_lookup[output[i] & 0xF]);
 720              		.loc 1 404 3 is_stmt 1 discriminator 3 view .LVU205
 404:.././simpleserial/simpleserial.c **** 		putch(hex_lookup[output[i] & 0xF]);
 721              		.loc 1 404 30 is_stmt 0 discriminator 3 view .LVU206
 722 0022 15F8013F 		ldrb	r3, [r5, #1]!	@ zero_extendqisi2
 723 0026 1B09     		lsrs	r3, r3, #4
 404:.././simpleserial/simpleserial.c **** 		putch(hex_lookup[output[i] & 0xF]);
 724              		.loc 1 404 3 discriminator 3 view .LVU207
 725 0028 F85C     		ldrb	r0, [r7, r3]	@ zero_extendqisi2
 726 002a FFF7FEFF 		bl	putch
 727              	.LVL64:
 405:.././simpleserial/simpleserial.c **** 	}
 728              		.loc 1 405 3 is_stmt 1 discriminator 3 view .LVU208
 405:.././simpleserial/simpleserial.c **** 	}
 729              		.loc 1 405 30 is_stmt 0 discriminator 3 view .LVU209
 730 002e 2B78     		ldrb	r3, [r5]	@ zero_extendqisi2
 731 0030 03F00F03 		and	r3, r3, #15
 405:.././simpleserial/simpleserial.c **** 	}
 732              		.loc 1 405 3 discriminator 3 view .LVU210
 733 0034 F85C     		ldrb	r0, [r7, r3]	@ zero_extendqisi2
 734 0036 FFF7FEFF 		bl	putch
 735              	.LVL65:
 402:.././simpleserial/simpleserial.c **** 	{
 736              		.loc 1 402 27 is_stmt 1 discriminator 3 view .LVU211
 737 003a EAE7     		b	.L60
 738              	.L63:
 739              		.align	2
 740              	.L62:
 741 003c 00000000 		.word	.LANCHOR1
 742              	.LBE14:
 743              		.cfi_endproc
 744              	.LFE9:
 746              		.section	.text.ss_num_commands,"ax",%progbits
 747              		.align	1
 748              		.global	ss_num_commands
 749              		.syntax unified
 750              		.thumb
 751              		.thumb_func
 752              		.fpu softvfp
 754              	ss_num_commands:
 755              	.LVL66:
 756              	.LFB2:
 239:.././simpleserial/simpleserial.c ****     uint8_t ncmds = num_commands & 0xFF;
 757              		.loc 1 239 1 view -0
 758              		.cfi_startproc
 759              		@ args = 0, pretend = 0, frame = 8
 760              		@ frame_needed = 0, uses_anonymous_args = 0
 240:.././simpleserial/simpleserial.c ****     simpleserial_put('r', 0x01, &ncmds);
 761              		.loc 1 240 5 view .LVU213
 239:.././simpleserial/simpleserial.c ****     uint8_t ncmds = num_commands & 0xFF;
 762              		.loc 1 239 1 is_stmt 0 view .LVU214
 763 0000 07B5     		push	{r0, r1, r2, lr}
 764              	.LCFI11:
 765              		.cfi_def_cfa_offset 16
 766              		.cfi_offset 14, -4
 240:.././simpleserial/simpleserial.c ****     simpleserial_put('r', 0x01, &ncmds);
 767              		.loc 1 240 13 view .LVU215
 768 0002 074B     		ldr	r3, .L65
 241:.././simpleserial/simpleserial.c ****     return 0x00;
 769              		.loc 1 241 5 view .LVU216
 770 0004 0DF10702 		add	r2, sp, #7
 240:.././simpleserial/simpleserial.c ****     simpleserial_put('r', 0x01, &ncmds);
 771              		.loc 1 240 13 view .LVU217
 772 0008 1B68     		ldr	r3, [r3]
 773 000a 8DF80730 		strb	r3, [sp, #7]
 241:.././simpleserial/simpleserial.c ****     return 0x00;
 774              		.loc 1 241 5 is_stmt 1 view .LVU218
 775 000e 0121     		movs	r1, #1
 776              	.LVL67:
 241:.././simpleserial/simpleserial.c ****     return 0x00;
 777              		.loc 1 241 5 is_stmt 0 view .LVU219
 778 0010 7220     		movs	r0, #114
 779              	.LVL68:
 241:.././simpleserial/simpleserial.c ****     return 0x00;
 780              		.loc 1 241 5 view .LVU220
 781 0012 FFF7FEFF 		bl	simpleserial_put
 782              	.LVL69:
 242:.././simpleserial/simpleserial.c **** }
 783              		.loc 1 242 5 is_stmt 1 view .LVU221
 243:.././simpleserial/simpleserial.c **** 
 784              		.loc 1 243 1 is_stmt 0 view .LVU222
 785 0016 0020     		movs	r0, #0
 786 0018 03B0     		add	sp, sp, #12
 787              	.LCFI12:
 788              		.cfi_def_cfa_offset 4
 789              		@ sp needed
 790 001a 5DF804FB 		ldr	pc, [sp], #4
 791              	.L66:
 792 001e 00BF     		.align	2
 793              	.L65:
 794 0020 00000000 		.word	.LANCHOR0
 795              		.cfi_endproc
 796              	.LFE2:
 798              		.section	.text.ss_get_commands,"ax",%progbits
 799              		.align	1
 800              		.global	ss_get_commands
 801              		.syntax unified
 802              		.thumb
 803              		.thumb_func
 804              		.fpu softvfp
 806              	ss_get_commands:
 807              	.LVL70:
 808              	.LFB3:
 252:.././simpleserial/simpleserial.c ****     ss_cmd_repr repr_cmd_buf[MAX_SS_CMDS];
 809              		.loc 1 252 1 is_stmt 1 view -0
 810              		.cfi_startproc
 811              		@ args = 0, pretend = 0, frame = 48
 812              		@ frame_needed = 0, uses_anonymous_args = 0
 253:.././simpleserial/simpleserial.c ****     for (uint8_t i = 0; i < (num_commands & 0xFF); i++) {
 813              		.loc 1 253 5 view .LVU224
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 814              		.loc 1 254 5 view .LVU225
 815              	.LBB15:
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 816              		.loc 1 254 10 view .LVU226
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 817              		.loc 1 254 10 is_stmt 0 view .LVU227
 818              	.LBE15:
 252:.././simpleserial/simpleserial.c ****     ss_cmd_repr repr_cmd_buf[MAX_SS_CMDS];
 819              		.loc 1 252 1 view .LVU228
 820 0000 70B5     		push	{r4, r5, r6, lr}
 821              	.LCFI13:
 822              		.cfi_def_cfa_offset 16
 823              		.cfi_offset 4, -16
 824              		.cfi_offset 5, -12
 825              		.cfi_offset 6, -8
 826              		.cfi_offset 14, -4
 827              	.LBB16:
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 828              		.loc 1 254 43 view .LVU229
 829 0002 1248     		ldr	r0, .L70
 830              	.LVL71:
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 831              		.loc 1 254 43 view .LVU230
 832 0004 0168     		ldr	r1, [r0]
 833              	.LVL72:
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 834              		.loc 1 254 43 view .LVU231
 835              	.LBE16:
 252:.././simpleserial/simpleserial.c ****     ss_cmd_repr repr_cmd_buf[MAX_SS_CMDS];
 836              		.loc 1 252 1 view .LVU232
 837 0006 8CB0     		sub	sp, sp, #48
 838              	.LCFI14:
 839              		.cfi_def_cfa_offset 64
 840              	.LBB17:
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 841              		.loc 1 254 43 view .LVU233
 842 0008 CDB2     		uxtb	r5, r1
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 843              		.loc 1 254 5 view .LVU234
 844 000a 0024     		movs	r4, #0
 845              	.LVL73:
 846              	.L68:
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 847              		.loc 1 254 25 is_stmt 1 discriminator 1 view .LVU235
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 848              		.loc 1 254 27 is_stmt 0 discriminator 1 view .LVU236
 849 000c E3B2     		uxtb	r3, r4
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 850              		.loc 1 254 5 discriminator 1 view .LVU237
 851 000e AB42     		cmp	r3, r5
 852 0010 04F10104 		add	r4, r4, #1
 853              	.LVL74:
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 854              		.loc 1 254 5 discriminator 1 view .LVU238
 855 0014 09DB     		blt	.L69
 856              	.LBE17:
 260:.././simpleserial/simpleserial.c ****     return 0x00;
 857              		.loc 1 260 5 is_stmt 1 view .LVU239
 858 0016 01EB4101 		add	r1, r1, r1, lsl #1
 859 001a 6A46     		mov	r2, sp
 860 001c C9B2     		uxtb	r1, r1
 861 001e 7220     		movs	r0, #114
 862 0020 FFF7FEFF 		bl	simpleserial_put
 863              	.LVL75:
 261:.././simpleserial/simpleserial.c **** }
 864              		.loc 1 261 5 view .LVU240
 262:.././simpleserial/simpleserial.c **** 
 865              		.loc 1 262 1 is_stmt 0 view .LVU241
 866 0024 0020     		movs	r0, #0
 867 0026 0CB0     		add	sp, sp, #48
 868              	.LCFI15:
 869              		.cfi_remember_state
 870              		.cfi_def_cfa_offset 16
 871              		@ sp needed
 872 0028 70BD     		pop	{r4, r5, r6, pc}
 873              	.LVL76:
 874              	.L69:
 875              	.LCFI16:
 876              		.cfi_restore_state
 877              	.LBB18:
 255:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].len = commands[i].len;
 878              		.loc 1 255 9 is_stmt 1 discriminator 3 view .LVU242
 255:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].len = commands[i].len;
 879              		.loc 1 255 27 is_stmt 0 discriminator 3 view .LVU243
 880 002a 03EB4302 		add	r2, r3, r3, lsl #1
 881 002e 0CAE     		add	r6, sp, #48
 255:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].len = commands[i].len;
 882              		.loc 1 255 40 discriminator 3 view .LVU244
 883 0030 00EB0313 		add	r3, r0, r3, lsl #4
 884              	.LVL77:
 255:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].len = commands[i].len;
 885              		.loc 1 255 27 discriminator 3 view .LVU245
 886 0034 3244     		add	r2, r2, r6
 887 0036 1E79     		ldrb	r6, [r3, #4]	@ zero_extendqisi2
 888 0038 02F8306C 		strb	r6, [r2, #-48]
 256:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].flags = commands[i].flags;
 889              		.loc 1 256 9 is_stmt 1 discriminator 3 view .LVU246
 256:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].flags = commands[i].flags;
 890              		.loc 1 256 29 is_stmt 0 discriminator 3 view .LVU247
 891 003c 9E68     		ldr	r6, [r3, #8]
 257:.././simpleserial/simpleserial.c ****     }
 892              		.loc 1 257 31 discriminator 3 view .LVU248
 893 003e 1B7C     		ldrb	r3, [r3, #16]	@ zero_extendqisi2
 256:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].flags = commands[i].flags;
 894              		.loc 1 256 29 discriminator 3 view .LVU249
 895 0040 02F82F6C 		strb	r6, [r2, #-47]
 257:.././simpleserial/simpleserial.c ****     }
 896              		.loc 1 257 9 is_stmt 1 discriminator 3 view .LVU250
 257:.././simpleserial/simpleserial.c ****     }
 897              		.loc 1 257 31 is_stmt 0 discriminator 3 view .LVU251
 898 0044 02F82E3C 		strb	r3, [r2, #-46]
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 899              		.loc 1 254 52 is_stmt 1 discriminator 3 view .LVU252
 900              	.LVL78:
 254:.././simpleserial/simpleserial.c ****         repr_cmd_buf[i].c = commands[i].c;
 901              		.loc 1 254 52 is_stmt 0 discriminator 3 view .LVU253
 902 0048 E0E7     		b	.L68
 903              	.L71:
 904 004a 00BF     		.align	2
 905              	.L70:
 906 004c 00000000 		.word	.LANCHOR0
 907              	.LBE18:
 908              		.cfi_endproc
 909              	.LFE3:
 911              		.section	.rodata
 912              		.set	.LANCHOR1,. + 0
 915              	hex_lookup:
 916 0000 30313233 		.ascii	"0123456789ABCDEF"
 916      34353637 
 916      38394142 
 916      43444546 
 917              		.bss
 918              		.align	2
 919              		.set	.LANCHOR0,. + 0
 922              	num_commands:
 923 0000 00000000 		.space	4
 926              	commands:
 927 0004 00000000 		.space	256
 927      00000000 
 927      00000000 
 927      00000000 
 927      00000000 
 928              		.text
 929              	.Letext0:
 930              		.file 2 "/usr/lib/gcc/arm-none-eabi/9.2.1/include/stdint.h"
 931              		.file 3 ".././hal/stm32f3/stm32f3_hal.h"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 simpleserial.c
     /tmp/ccbq0RBP.s:16     .text.check_version:0000000000000000 $t
     /tmp/ccbq0RBP.s:24     .text.check_version:0000000000000000 check_version
     /tmp/ccbq0RBP.s:43     .text.ss_crc:0000000000000000 $t
     /tmp/ccbq0RBP.s:50     .text.ss_crc:0000000000000000 ss_crc
     /tmp/ccbq0RBP.s:114    .text.hex_decode:0000000000000000 $t
     /tmp/ccbq0RBP.s:121    .text.hex_decode:0000000000000000 hex_decode
     /tmp/ccbq0RBP.s:288    .text.simpleserial_addcmd_flags:0000000000000000 $t
     /tmp/ccbq0RBP.s:295    .text.simpleserial_addcmd_flags:0000000000000000 simpleserial_addcmd_flags
     /tmp/ccbq0RBP.s:354    .text.simpleserial_addcmd_flags:0000000000000028 $d
     /tmp/ccbq0RBP.s:359    .text.simpleserial_addcmd:0000000000000000 $t
     /tmp/ccbq0RBP.s:366    .text.simpleserial_addcmd:0000000000000000 simpleserial_addcmd
     /tmp/ccbq0RBP.s:384    .text.simpleserial_init:0000000000000000 $t
     /tmp/ccbq0RBP.s:391    .text.simpleserial_init:0000000000000000 simpleserial_init
     /tmp/ccbq0RBP.s:432    .text.simpleserial_init:0000000000000024 $d
     /tmp/ccbq0RBP.s:806    .text.ss_get_commands:0000000000000000 ss_get_commands
     /tmp/ccbq0RBP.s:754    .text.ss_num_commands:0000000000000000 ss_num_commands
     /tmp/ccbq0RBP.s:439    .text.simpleserial_get:0000000000000000 $t
     /tmp/ccbq0RBP.s:446    .text.simpleserial_get:0000000000000000 simpleserial_get
     /tmp/ccbq0RBP.s:647    .text.simpleserial_get:00000000000000b0 $d
     /tmp/ccbq0RBP.s:653    .text.simpleserial_put:0000000000000000 $t
     /tmp/ccbq0RBP.s:660    .text.simpleserial_put:0000000000000000 simpleserial_put
     /tmp/ccbq0RBP.s:741    .text.simpleserial_put:000000000000003c $d
     /tmp/ccbq0RBP.s:747    .text.ss_num_commands:0000000000000000 $t
     /tmp/ccbq0RBP.s:794    .text.ss_num_commands:0000000000000020 $d
     /tmp/ccbq0RBP.s:799    .text.ss_get_commands:0000000000000000 $t
     /tmp/ccbq0RBP.s:906    .text.ss_get_commands:000000000000004c $d
     /tmp/ccbq0RBP.s:915    .rodata:0000000000000000 hex_lookup
     /tmp/ccbq0RBP.s:918    .bss:0000000000000000 $d
     /tmp/ccbq0RBP.s:922    .bss:0000000000000000 num_commands
     /tmp/ccbq0RBP.s:926    .bss:0000000000000004 commands

UNDEFINED SYMBOLS
getch
putch
